-- Coluna nome e campos recomendados em programa
ALTER TABLE public.programa ADD COLUMN IF NOT EXISTS nome text;
COMMENT ON COLUMN public.programa.nome IS 'Nome do programa (empresa, órgão, projeto, cliente, etc.)';

ALTER TABLE public.programa ADD COLUMN IF NOT EXISTS tipo_programa text;
COMMENT ON COLUMN public.programa.tipo_programa IS 'Tipo: empresa_organizacao, cliente, projeto_produto, unidade_departamento';

ALTER TABLE public.programa ADD COLUMN IF NOT EXISTS descricao_escopo text;
COMMENT ON COLUMN public.programa.descricao_escopo IS 'Descrição curta do escopo do programa';

-- Tabela empresa (CNPJ, razão social, nome fantasia separados do programa)
CREATE TABLE IF NOT EXISTS public.empresa (
  id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  cnpj numeric,
  razao_social text,
  nome_fantasia text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
COMMENT ON TABLE public.empresa IS 'Empresas/organizações; um programa pode ser vinculado a uma empresa';

-- FK programa -> empresa
ALTER TABLE public.programa ADD COLUMN IF NOT EXISTS empresa_id integer REFERENCES public.empresa(id);
COMMENT ON COLUMN public.programa.empresa_id IS 'Empresa vinculada ao programa (quando setor privado)';

-- Grants (consistente com outras tabelas do projeto)
GRANT ALL ON TABLE public.empresa TO anon;
GRANT ALL ON TABLE public.empresa TO authenticated;
GRANT ALL ON TABLE public.empresa TO service_role;
GRANT USAGE, SELECT ON SEQUENCE public.empresa_id_seq TO anon, authenticated, service_role;
